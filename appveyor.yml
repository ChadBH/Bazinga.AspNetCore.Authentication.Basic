configuration: Release
init:
  - git config --global core.autocrlf true
  # If there's a tag, use that as the version.
  - ps: >-
      if($env:APPVEYOR_REPO_TAG -eq "true"){Update-AppveyorBuild -Version "$env:APPVEYOR_REPO_TAG_NAME"}
build_script:
  - cmd: dotnet test test\Bazinga.AspNetCore.Authentication.Basic.Tests.csproj -c Release
after_build:
  - cmd: dotnet pack --no-build -c Release
on_success:
  - ps: .\coverage.ps1 -UploadCodecov
install:
  - ps: $env:DOTNET_INSTALL_DIR = "$pwd\.dotnetsdk"
  - ps: mkdir $env:DOTNET_INSTALL_DIR -Force | Out-Null
  - ps: $installScript = [System.IO.Path]::Combine([System.IO.Path]::GetTempPath(), [System.IO.Path]::GetRandomFileName())
  - ps: Invoke-WebRequest "https://dot.net/v1/dotnet-install.ps1" -OutFile $installScript -UseBasicParsing
  - ps: & $installScript -Version "$env:DOTNET_VERSION" -InstallDir "$env:DOTNET_INSTALL_DIR" -NoPath
  - ps: $env:Path = "$env:DOTNET_INSTALL_DIR;$env:Path"
environment:
  global:
    DOTNET_VERSION: 3.0.100-preview3-010431
test: off
os: Visual Studio 2017
dotnet_csproj:
  patch: true
  file: 'src\**\*.csproj'
  version: '{version}'
  package_version: '{version}'
artifacts:
- path: '**\*.nupkg'
  name: bazinga-basic-auth-nuget-packages
deploy:
  release: $(appveyor_build_version)
  provider: GitHub
  auth_token:
    secure: ec+Solbkj/2PwO6fDaJYlHPLm9qMqx13xlO3byqtlKGOZcW3thTp5nXNwi6m3PwE
  artifact: /.*\.nupkg/
  draft: true
  on:
    appveyor_repo_tag: true